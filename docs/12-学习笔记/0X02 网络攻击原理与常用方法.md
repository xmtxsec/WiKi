
# 网络攻击概念
网络攻击是指损害网络系统安全属性的危害行为。危害行为导致网络系统的机密性、完整性、可用性、可控性、真实性、抗抵赖性受到不同程度的破坏<br />常见的危害行为有四个基本类型：

1. 信息泄露攻击（机密性）
2. 完整性破坏攻击（完整性）
3. 拒绝服务攻击（可用性）
4. 非法使用攻击（抗抵赖性）

1. 攻击者：根据网络攻击来源可以分为内部人员和外部人员；根据网络攻击的攻击与目的可以分为间谍、恐怖主义者、黑客、职业犯罪分子、公司职员和破坏者。
2. 攻击工具：用户命令、脚本或程序、自治主体、电磁泄漏。
3. 攻击访问：包括合法和非法的访问，攻击过程主要依赖于非法访问和目标网络资的使用，即未授权访问或未授权使用目标系统的资源。
4. 攻击效果：破坏信息、信息泄露、窃取服务、拒绝服务。
5. 攻击意图：黑客-表现自己或技术挑战；间谍-获取情报信息；恐怖主义者-获取恐怖主义集团的利益；公司职员-好奇显示才干；职业犯罪分析-获取经济利益；破坏者-报复或发泄不满情绪。


## 网络攻击模型
**攻击树模型**<br />起源于故障树分析方法，用AND-OR形式的树结构对目标对象进行网络威胁分析。攻击树方法可以被红队用来进行渗透测试也可以被蓝队用来研究防御机制。优点：能够采取专家头脑风暴法，并将这些意见融合到攻击树中去；能够进行费效分析或者概率分析；能够建模非常复杂的攻击场景。缺点：由于内在限制不能用来建模多重尝试攻击、时间依赖控制等场景；不能用来建模循环事件；对现实中的大规模网络，攻击树方法处理起来将会特别复杂。

[**MITRE ATT&CK模型**](https://attack.mitre.org/#)
根据真实观察到的网络攻击数据提炼形成攻击矩阵模型，该模型把攻击活动抽次为初始访问、执行、持久化、特权提升、躲避防御、凭据访问、发现、横向移动、收集、指挥和控制、外泄、影响，然后给出攻击活动的具体实现方式，基于MITRE ATT&CK常见的应用场景主要有网络红蓝对抗模拟、网络安全渗透测试、网络防御差距评估、网络威胁情报收集等。

**网络杀伤链模型**<br />该模型将网络攻击活动分为目标侦察、武器构造、载荷投射、漏洞利用、安装植入、指挥和控制、目标行动等七个阶段。


## 网络攻击发展
网络攻击具有以下变化趋势：

1. 网络攻击工具智能化、自动化；
2. 网络攻击者群体普适化；
3. 网络攻击目标多样化和隐蔽性；
4. 网络攻击计算资源获取方便；
5. 网络攻击活动持续性强化；
6. 网络攻击速度加快；
7. 网络攻击影响扩大；
8. 网络攻击主体组织化；


# 网络攻击一般过程

1. 隐蔽攻击源：利用被入侵的主机作为跳板、免费代理网关、伪造IP地址、假冒用户账号；
2. 收集目标信息：目标系统一般信息、配置信息、安全漏洞信息、安全措施信息、用户信息；
3. 挖掘漏洞信息：系统或应用服务软件漏洞、主机信任关系漏洞、目标网络的使用者漏洞、通信协议漏洞、网络业务系统漏洞；
4. 获取目标访问权限：系统管理员口令、系统管理上的漏洞、使系统运行一些特洛伊木马、窃听管理员口令；
5. 隐蔽攻击行为：连接隐蔽、进程隐蔽、文件隐蔽；
6. 实施攻击：攻击其他被信任的主机和网络、修改或删除重要数据、窃听敏感数据、停止网络服务、下载敏感数据、删除数据账号、修改数据记录；
7. 开辟后门：放宽文件许可权、开放不安全服务、修改系统配置、替换系统本身的共享库文件、修改系统源码安装各种特洛伊木马、安装嗅探器、建立隐蔽通道；
8. 清除攻击痕迹：篡改日志文件、改变系统时间造成日志文件数据紊乱、删除或停止审计服务进程、干扰入侵检测系统的正常运行、修改完整性检测标签；


# 网络攻击常见技术方法

## 端口扫描
端口扫描的目的是找出目标系统上提供的服务列表。扫描程序依次尝试与TCP/IP端口链接然后根据端口与服务的对应关系，结合服务器端的反应推断出目标系统上是否运行了某项服务。

**知识补充：**TCP/IP三次握手
![image.png](./assets/1652236891465-80d4c709-071a-42bc-be69-927067fb518b.png)

1. 在打算建立TCP连接时，A向B发出连接请求报文段，这时首部中的同步位SYN = 1，同时选择一个初始序号seq = x。TCP规定，SYN报文段(即SYN = 1的报文段)不能携带数据，但要消耗掉一个序号。这时，TCP客户进程进入SYN-SENT (同步已发送)状态。
2. B收到连接请求报文段后，如同意建立连接，则向A发送确认。在确认报文段中应把SYN位和ACK位都置1，确认号是ack=x+1，同时也为自己选择一个初始序号 seq= y。这个报文段也不能携带数据，但同样要消耗掉一个序号。这时TCP服务器进程进入SYN-RCVD ( 同步收到)状态。
3. TCP客户进程收到B的确认后，还要向B给出确认。确认报文段的ACK置1,，确认号ack=y+ 1，而自己的序号seq=x+ 1。TCP的标准规定，ACK报文段可以携带数据。但如果不携带数据则不消耗序号，在这种情况下，下一个数据报文段的序号仍是seq=x+1.这时，TCP 连接已经建立，A进入ESTABLISHED (已建立连接)状态。当B收到A的确认后，也进入ESTABLISHED状态。

**1、完全连接扫描**<br />利用TCP/IP协议的三次握手连接机制，使源主机和目的主机的某个端口建立一次完整的链接。如果建立成功，则表明该端口开放。否则，表明该端口关闭。

**2、半连接扫描**<br />在源主机和目标主机的三次握手连接过程中，只完成前两次握手，不建立一次完成的连接。

**3、SYN扫描**<br />先向目标主机发送连接请求，当目标主机返回响应后，立即切断连接过程，并查看响应情况。如果目标主机返回ACK信息，表示目标主机的该端口开放。如果目标主机返回RESET信息，表示该端口没有开放。

[**4、ID头信息扫描（僵尸扫描）**](https://www.yuque.com/xmtxsec/blog/bb55wp)
首先由A主机向dump主机B发送连续的ping数据包，并查看主机B返回的数据包的ID头信息。一般而言，每个顺序数据包的ID头的值会增加1。然后由源主机A假冒主机B的地址向目的主机C的任意端口（1~65535）发送SYN数据包，这时。主机C向主机B发送的数据包有两种可能的结果：

- SYN|ACK 表示该端口处于监听状态。
- RST|ACK  表示该端口处于非监听状态。

由后续的ping数据包的响应信息的ID头信息可以看出，如果C主机的某个端口时开放的，则主机B返回A的数据包中，ID头的值不是递增1，而是大于1。如果主机C的某个端口是非开放的，则主机B返回A的数据包中，ID头的值是递增1，非常规律。

**5、隐蔽扫描**<br />隐蔽扫描是指能够成功地绕过IDS、防火墙、和监视系统等安全机制，取得目标主机端口信息的一种扫描方式。

**6、SYN|ACK扫描**<br />由源主机向目标主机的某个端口直接发送SYN|ACK数据包，由于这种方法不发送SYN数据包，目标主机会认为这是一此错误的连接，从而会报错。当端口没有开放则会返回RST信息，如果端口开放则不会返回任何信息，而是直接将这个数据包抛弃掉。

**7、FIN扫描**<br />源主机向目标主机发送FIN数据包，然后查看反馈信息。若端口关闭则返回RESET信息，若端口开放则不返回任何信息。

**8、ACK扫描**<br />主机A向主机B发送FIN数据包，然后查看反馈数据包的TTL值和WIN值。开放端口所返回的TTL值一般小于64，WIN值大于0；关闭端口所返回的TTL值一般大于64，WIN值一般等于0。

**9、NULL扫描**<br />将源主机发送的数据包中的ACK、FIN、RST、SYN、URG、PSH等标志位全部置空。如果目标主机没有返回任何信息则端口开放，如果返回RST信息则表明端口关闭。

**10、XMAS扫描**<br />将源主机发送的数据包中的ACK、FIN、RST、SYN、URG、PSH等标志位全部置为1、如果目标主机没有返回任何信息则端口开放，如果返回RST信息则表明端口关闭。

总结：无论发送什么数据包，只要返回的信息是RESET或者RST则表明目标端口是关闭的。


## 口令破解
口令破解是资源访问控制的第一道屏障。攻击者常常以破解用户的弱口令为突破口，获取系统的访问权限。<br />主要工作流程如下：

1. 建立如目标网络服务的网络连接；
2. 选取一个用户列表文件及字典文件；
3. 在用户列表及字典中，选取一组用户和口令，按照网络服务协议规定，将用户名及口令发送给目标网络服务端口；
4. 检测远程服务返回信息，确认口令尝试是否成功；
5. 再取另外一组用户和口令，重复循环实验，直至破成功。


## 缓冲区溢出
通过往程序的缓冲区写出超出其长度的内容，造成缓冲区溢出，从而破坏程序的堆栈，使程序转而执行其他预设指令，以达到攻击目的的攻击方法。<br />堆：先进先出<br />栈：先进后出


## 恶意代码
常见的恶意代码类型有计算机病毒、网络蠕虫、特洛伊木马、后门、逻辑炸弹、僵尸网络等。


## 拒绝服务
攻击者利用系统的缺陷，执行一些恶意的操作，使得合法的系统用户不能及时得到应得的服务或系统资源。拒绝服务攻击最本质的特长是延长服务等待事件。当服务等待事件超过某个阈值时，用户因无法忍耐而放弃服务。<br />特点：

- 难确认性，拒绝服务攻击很难判断，用户在自己的服务得不到及时响应时，并不认为自己(或者系统)受到攻击，反而可能认为是系统故障造成一时的服务失效。
- 隐蔽性，正常请求服务隐藏拒绝服务攻击的过程。
- 资源有限性，由于计算机资源有限，容易实现拒绝服务攻击。
- 软件复杂性，由于软件所固有的复杂性，设计实现难以确保软件没有缺陷。

**1、同步包风暴（SYN Flood）**<br />攻击者假造源网址(Source IP)发送多个同步数据包(Syn Packet)给服务 器(Server) ，服务器因无法收到确认数据包(Ack Packet) ，使TCP/IP 协议的三次握手( Three-WayHand-Shacking)无法顺利完成，因而无法建立连接。其原理是发送大量半连接状态的服务请求，使Unix等服务主机无法处理正常的连接请求，因而影响正常运作。

**2、UDP洪水（UDP Flood）**<br />利用简单的TCP/IP服务，如用Chargen和Echo传送毫无用处的占满带宽的数据。通过伪造与某一主机的Chargen服务之间的一次UDP连接,回复地址指向开放Echo服务的一台主机，生成在两台主机之间的足够多的无用数据流。

**3.、Smurf攻击**<br />Smurf攻击是将回复地址设置成目标网络广播地址的ICMP应答请求数据包，使该网络的所有主机都对此ICMP应答请求作出应答，导致网络阻塞，更加复杂的Smurf攻击是将源地址改为第三方的目标网络，最终导致第三方网络阻塞。

**4、垃圾邮件**<br />攻击者利用邮件系统制造垃圾信息，甚至通过专门的邮件炸弹(mail bomb)程序给受害用户的信箱发送垃圾信息，耗尽用户信箱的磁盘空间，使用户无法应用这个信箱。

**5、消耗CPU和内存资源的拒绝服务攻击**<br />利用目标系统的计算算法漏洞，构造恶意输入数据集，导致目标系统的CPU或内存资源耗尽，从而使目标系统瘫痪。

**6、死亡之ping (ping of deat**h)
早期，路由器对包的最大尺寸都有限制，许多操作系统在实现TCP/IP堆栈时，规定ICMP包小于等于64KB， 并且在对包的标题头进行读取之后，要根据该标题头中包含的信息为有效载荷生成缓冲区。当产生畸形的、尺寸超过ICMP上限的包， 即加载的尺寸超过64KB上限时，就会出现内存分配错误，导致TCP/IP堆栈崩溃，使接收方机。

**7、泪滴攻击(Teardrop Attack)**<br />泪滴攻击暴露出IP数据包分解与重组的弱点。当IP数据包在网络中传输时，会被分解成许多不同的片传送，并借由偏移量字段(Offset Field)作为重组的依据。泪滴攻击通过加入过多或不必要的偏移量字段，使计算机系统重组错乱，产生不可预期的后果。

**8、分布式拒绝服务攻击(Distributed Denial of Service Attack)**<br />分布式拒绝服务攻击是指植入后广]程序从远程遥控攻击，攻击者从多个已入侵的跳板主机控制数个代理攻击主机，所以攻击者可同时对已控制的代理攻击主机激活干扰命令，对受害主机大量攻击。


## 网络钓鱼
网络钓鱼（Phishing）是一种通过假冒可信方提供上网服务，以欺骗的手段获取敏感个人信息的攻击方式。


## 网络窃听
利用网络通信技术缺陷，使得攻击者能够获取到其他人的网络通讯信息。常见的网络窃听技术手段主要有网络嗅探、中间人攻击。网络攻击者将主机网络接口的方式设成“杂乱模式”，就可以接收整个网络上的信息包，从而可以获取敏感的口令，甚至将其重组，还原为用户传递的文件。


## SQL注入
在Web服务中，一般采用三层架构模式：浏览器+Web服务器+数据库。Web脚本程序负责处理来自浏览器端提交的信息。但是，由于Web脚本程序的编程漏洞，对来自浏览器端的信息缺少输入安全合法性检查，网络攻击者利用这种类型的漏洞，把SQL命令插入Web表单的输入域或页面的请求查找字符串，欺骗服务器执行恶意的SQL命令。


## 社交工程
网络攻击者通过一系列的社交活动，获取需要的信息。例如伪造系统管理员的身份，给特定的用户发电子邮件骗取他的密码口令。有的攻击者会给用户送免费实用程序，不过该程序除了完成用户所需的功能外，还隐藏了一个将用户的计算机信息发送给攻击者的功能。


## 电子监听
网络攻击者采用电子设备远距离地监视电磁波的传送过程。灵敏的无线电接收装置能够在远处看到计算机操作者输入的字符或屏幕显示的内容。


## 会话劫持
会话劫持是指攻击者在初始授权之后建立一个连接，在会话劫持以后，攻击者具有合法用户的特权权限。


## 漏洞扫描
漏洞扫描是一种自动检测远程或本地主机安全漏洞的软件，通过漏洞扫描器可以自动发现系统的安全漏洞。常见的漏洞扫描技术有CGI漏洞扫描、弱口令扫描、操作系统漏洞扫描、数据库漏洞扫描等。


## 代理技术 
网络攻击者通过免费代理服务器进行攻击，其目的是以代理服务器为“攻击跳板”，即使攻击目标的网络管理员发现了，也难以追踪到网络攻击者的真实身份或IP地址。为了增加追踪的难度，网络攻击者还会用多级代理服务器或者“跳板主机”来攻击目标。


## 数据加密
网络攻击者常常采用数据加密技术来逃避网络安全管理人员的追踪。加密使网络攻击者的数据得到有效保护，即使网络安全管理人员得到这些加密的数据，没有密钥也无法读懂，这样就实现了攻击者的自身保护。攻击者的安全原则是，任何与攻击有关的内容都必须加密或者立刻销毁。


# 黑客常用工具
攻击者常常采用的工具，主要包括扫描器、远程监控、密码破解、网络嗅探器、安全渗透工具箱等。


## 扫描器
通过扫描程序，黑客可以找到攻击目标的IP 地址、开放的端口号、服务器运行的版本、程序中可能存在的漏洞等。根据不同的扫描目的，扫描类软件又分为地址扫描器、端口扫描器、漏洞扫描器三个类别。

- NMAP NMap (Network Map)即网络地图，通过NMap可以检测网络上主机的开放端口号、主机的操作系统类型以及提供的网络服务。
- Nessus 早期是免费的、开放源代码的远程安全扫描器，可运行在Linux操作系统平台上，支持多线程和插件。
- SuperScan SuperScan 是一款具有 TCP connect端口扫描、Ping 和域名解析等功能的工具，能较容易地对指定范围内的IP地址进行Ping和端口扫描。


## 远程监控
远程监控实际上是在受害机器上运行一个代理软件，而在黑客的电脑中运行管理软件，受害机器受控于黑客的管理端。受害机器通常被称为“肉鸡”，其经常被用于发起DDoS拒绝服务攻击或作为攻击跳板。常见的远程监控工具有冰河、网络精灵、Netcat 。


## 密码破解
密码破解是安全渗透常用的工具，常见的密码破解方式有口令猜测主要针对用户的弱口令。穷举搜索就是针对用户密码的选择空间，使用高性能计算机，逐个尝试可能的密码，直至搜索到用户的密码。撞库则根据已经收集到的用户密码的相关数据集，通过用户关键词搜索匹配，与目标系统的用户信息进行碰撞，以获取用户的密码。<br />密码破解的常见工具如下：

- John the Ripper 用于检查Unix/Linux 系统的弱口令，支持几乎所有Unix平台上经crypt函数加密后的口令哈希类型。
- LophtCrack  常用于破解Windows系统口令,含有词典攻击、组合攻击、强行攻击等多种口令猜解方法。


## 网络嗅探器
通过网络嗅探，黑客可以截获网络的信息包，之后对加密的信息包进行破解，进而分析包内的数据，获得有关系统的信息。<br />常见的网络嗅探器工具有Tcpdump、DSniff、 WireShark 等。

- Tcpdump 是基于命令行的网络数据包分析软件，可以作为网络嗅探工具，能把匹配规则的数据包内容显示出来。
- WireShark 则提供图形化的网络数据包分析功能，可视化地展示网络数据包的内容。
- DSniff是由Dug Song 开发的一套包含多个工具的软件套件，包括dsniff、filesnarf、mailsnarf、 msgsnarf、 rlsnarf 和webspy。 使用DSniff可以获取口令、邮件、文件等信息。


## 安全渗透工具箱

1. Metasploit 是一个开源渗透测试工具，提供漏洞查找、漏洞利用、漏洞验证等服务功能。Metasploit支持1500多个漏洞挖掘利用，提供OWASP TOP10漏洞测试。
2. BackTrack5 集成了大量的安全工具软件，支持信息收集、漏洞评估、漏洞利用、特权提升、保持访问、逆向工程、压力测试。


# 网络攻击案例分析

## DDOS攻击
DDoS的整个攻击过程可以分为以下五个步骤:

1. 通过探测扫描大量主机，寻找可以进行攻击的目标;
2. 攻击有安全漏洞的主机，并设法获取控制权;
3. 在已攻击成功的主机中安装客户端攻击程序;
4. 利用已攻击成功的主机继续进行扫描和攻击;
5. 当攻击客户端达到一定的数目后，攻击者在主控端给客户端攻击程序发布向特定目标进行攻击的命令。

DDoS常用的攻击技术手段有HTTP Flood 攻击、SYN Flood攻击、DNS放大攻击等。其中，HTTP Flood 攻击是利用僵尸主机向特定目标网站发送大量的HTTP GET请求，以导致网站瘫痪。
![image.png](./assets/1652251506686-3070759f-9b18-4972-ae4b-0332b4016418.png)

SYN Flood攻击利用TCP/IP协议的安全缺陷，伪造主机发送大量的SYN包到目标系统，导致目标系统的计算机网络瘫痪。
![image.png](./assets/1652251576805-e392040d-8be1-47d0-9130-e80d86e03fbe.png)

DNS放大攻击是攻击者假冒目标系统向多个DNS解析服务器发送大量请求，而导致DNS解析服务器同时应答目标系统，产生大量网络流量，形成拒绝服务。
![image.png](./assets/1652251610652-5d559c71-4457-47fd-b0ee-6cd041a9df3f.png)


## W32.Blaster.Worm
W32.Blaster.Worm是一种利用DCOM RPC漏洞进行传播的网络蠕虫，其传播能力很强。<br />感染蠕虫的计算机系统运行不稳定，系统会不断重启。并且该蠕虫还将对windowsupdate.com<br />进行拒绝服务攻击，使得受害用户不能及时地得到这个漏洞的补丁。
![image.png](./assets/1652251656206-8c3ba13f-1d70-47f7-9ad0-dfb1f0e0d5d9.png)

1. 创建一个名为BILLY的互斥体。如果这个互斥体存在，蠕虫将放弃感染并退出。
2. 在注册表中添加下列键值："windows auto update"="msblast.exe"并且将其添加至：HKEY LOCAL MACHINE\SOFTWARE\MicrosoftWindows\CurrentVersion\Run这样就可以使蠕虫在系统被重起的时候能够自动运行。
3. 蠕虫生成攻击IP地址列表，尝试去感染列表中的计算机，蠕虫对有DCOM RPC漏洞的机器发起TCP 135端口的连接，进行感染。
4. 在TCP 4444端口绑定一个cmd.exe的后门。
5. 在UDP port 69口上进行监听。如果收到了一个请求，将把Msblast.exe发送给目标机器。
6. 发送命令给远端的机器使它回联已经受到感染的机器并下载Msblast.exe。
7. 检查当前日期及月份，若当前日期为16日或以后，或当前月份处在9月到12月之间，则W32.Blaster. Worm蠕虫将对windowsupdate.com发动TCP同步风暴拒绝服务攻击。


##  网络安全导致停电事件 
 黑客首先利用钓鱼邮件，欺骗电力公司员工下 载了带有 BlackEnergy 的恶意代码文件，然后诱导用户打开这个文件，激活木马，安装 SSH 门和系统自毁工具 ldisk, 致使黑客最终获得了主控电脑的控制权。最后，黑客远程操作恶 意代码将电力公司的主控计算机与变电站断连并切断电源；同时，黑客发动 DDoS 攻击电力客 服中心，致使电厂工作人员无法立即进行电力维修工作。  
![image.png](./assets/1652251781758-413c06b5-7bff-43a8-bfc5-1f67013d7875.png)
