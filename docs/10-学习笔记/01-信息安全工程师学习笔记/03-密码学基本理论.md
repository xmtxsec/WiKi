
# 1、密码学概况

## 1.1、密码学发展简况
密码学是一门研究信息安全保护的科学，以实现信息的保密性、完整性、可用性及抗抵赖性。密码学主要由密码编码（加密）和密码分析（解密）两个部分组成。其中，密码编码学研究信息的变换处理 以实现信息的安全保护，而密码分析学则研究通过密文获取对应的明文信息。  



- 1949 年，香农发表了著名的论文《保密系统的通信理论》
- 密码成为网络与信息安全的核心技术和基础支撑。
- 2005 年4月1日起国家施行 《中华人民共和国电子签名法》。
- 2006 年我国政府公布了自己的商用密码 法，成为我国密码发展史上的一件大事。
- 2019 年《中华人民共和国密码法》草案已经发布。  




## 1.2、密码学基本概念

- 明文：需要采用密码技术进行保护的消息。
- 密文：用密码技术处理过明文的结果，通常称为加密消息。
- 加密：将明文变换成密文的过程。
- 解密：由密文恢复出原明文的过程。
- 加密算法：加密过程所使用的一组操作运算规则。
- 解密算法：解密过程所使用的一组操作运算规则。
- 加密和解密算法的操作通常都是在密钥控制下进行的，分别称为加密密钥和解密密钥。  




## 1.3、密码安全性分析
密码分析攻击类型分为五种：

1. 唯密文攻击：密码分析者只拥有一个或多个用同一个密钥加密的密文，没有其他可利用的信息。
2. 已知明文攻击：密码分析者仅知道当前密钥下的一些明文及所对应的密文。
3. 选择明文攻击：密码分析者能够得到当前密钥下自己选定的明文所对应的密文。
4. 密文验证攻击：密码分析者对于任何选定的密文， 能够得到该密文“是否合法”的判断。
5. 选择密文攻击：除了挑战密文外，密码分析者能够得到任何选定的密文所对应的明文。  




# 2、密码学体制分类
根据密钥的特点，密码体制分为私钥和公钥密码体制两种，而介于私钥和公钥之间的密码体制称为混合密码体制。




## 2.1、私钥密码体制
私钥密码体制又称为对称密码体制。

**特点：**加密和解密使用相同的密钥 。

缺陷：密钥分配问题、密钥管理问题以及无法认证源。



目前私钥密码典型算法有 DES、3DES、IDEA、AES、RC-5。其中 DES 是美国早期数据加密标准，现在已经被 AES 取代。  

| 算法 | 详情 |
| --- | --- |
| DES | 56位密钥、64位数据块 |
| 3DES | 两个56位的密钥，因为一般K1和K3的密钥相同 |
| IDEA | 128位密钥、64位数据块 |



## 2.2、公钥密码体制
公钥密码体制又称为非对称密码体制，其基本原理是在加密和解密的过程中使用不同的密钥处理方式，其中，加密密钥可以公开，而只需要把解密密钥安全存放即可。  



**技术原理**：发送方甲方和接收方乙方都分别有各自的公钥和私钥，且甲方的公钥加密只能由甲方的私钥解密，乙方同。双方的公钥是可以共享的，但是私钥只能自己保密，此时，甲方要传输数据给乙方，应该使用乙方的公钥来加密，这样，只有使用乙方的私钥才能解密，而乙方的私钥只有乙方才有，保证了数据的保密性，也不用分发解密的密钥。



**优点：**密钥分发方便、密钥保管量少、支持数字签名。

**缺点：**加密速度慢。



目前，有三种公钥密码体制类型被证明是安全和有效的，即 RSA 体制、 ELGamal 体制及 椭圆曲线密码体制。



**常见的非对称加密算法：**RSA、Elgamal、ECC (椭圆曲线算法)、背包算法、Rabin、D-H等。




## 2.3、混合密码体制
混合密码体制利用公钥密码体制分配私钥密码体制的密钥，消息的收发双方共用这个密钥，然后按照私钥密码体制的方式，进行加密和解密运算。



**技术原理：**发送方用对称密钥加密需要发送的消息，再用接收方的公钥加密对称密钥，然后一起发送给接收方。接收方先用自己的私钥解密得到对称密钥，然后用对称密钥解密得到明文。




# 3、常见密码算法

## 3.1、DES
DES (Data Encryption Standard) 是一个分组加密算法，**能够支待 64 比特的明文块加密，其密钥长度为 56 比特。**



## 3.2、TDEA
TDEA 算法的工作机制是使用 DES 对明文 进行`加密一解密一加密`操作，即对 DES 加密后的密文进行解密再加密，而解密则相反。  一般K1和K3是相同的密钥，所以TDEA的密钥长度为56+56=112。




##  3.3、IDEA
IDEA (International Data Encryption Algorithm) 是一个分组加密处理算法，**其明文和密文分组都是 64 比特，密钥长度为 128 比特。**



## 3.4、AES
AES (Advanced Encryption Standard) 算法满足的要求：

- 密码必须是没有密级的，绝不能像商业秘密那样来保护它
- 算法的全部描述必须公开披露
- 密码必须可以在世界范围内免费使用
- 密码系统支持至少 128 比特长的分组
- 密码支持的密钥长度至少为 128、192、256 比特




## 3.5、RSA
**数学基础**

- 欧拉函数：对于一个正整数 n，小于 n 且与 n 互素的正整数的个数，记为 φ (n)
- 对于一个素数 n，可知  φ (n)=n-1
- 对于两个素数 p 和 q ，它们的乘积满足 n = p q， 则可知 φ (n)=(p-1)*(q-1)
- 欧几里得算法：gcd (a, b)表示 a 和 b 的最大公因数，如gcd (a, b)=1,则表示 a ,  b 的最大公因数为 1，说明 a 和 b 互素
- 同余：两个整数 a ,  b 若它们除以整数 m 所得的余数相等，则称 a 与 b 对于模 m 同余，或 a 同余于 b 模 m，记作 a ≡ b (mod m)，表示 a 与 b 对模 m 同余。例如: 26≡2 (mod 12) 



**RSA 算法**

RSA 算法是非对称算法，在 RSA 加密算法中，公钥和私钥都可以用于加密消息，用于加密消息的密钥与用于解密消息的密钥相反。 RSA 算法提供了一种保护网络通信和数据存储的机密性、完整性、真实性和不可否认性的方法。



**RSA 算法基于大整数因子分解的困难性，该算法的步骤如下：**

1. 随机生成两个大素数 p 和 q。
2. 计算这两个素数的乘积 n = p * q，将 n 公开。
3. 计算小于 n 并且与 n 互素的整数的个数，即欧拉函数 φ (n) = (p-1)*(q-1)  ，φ (n)保密。
4. 随机选取一个正整数 e ，且满足1 < e <  φ (n) ，并且 gcd ( e , φ (n)) = 1，将 e 公开。
5.  计算 d≡e mod φ (n)
6.  保密d、p、q，而公开 n 和 e , d 作为私钥，n 和 e 而作为公钥。



**加密：**_C=Me mod n_

**解密：**_M = Cd mod n_



**乘法逆元求法（常考考点）**

eg1：5 * d ≡ 1 mod 64，求d。

分析：5 * d ≡ 1 mod 64 即 (5 * d)  mod 64 = 1 mod 64 ，而1除以任何数的余数都为1，可以得到1  mod 64 = 1

设：5 * d / 64 的商为x，得5 * d  = 64x + 1 mod 64

5 * d  = 64x + 1 mod 64

d = (64x + 1)/5

当x = 1 时，能整除，d = 13。



eg2：5 * d ≡ 1 mod 72，求d

分析：5 * d ≡ 1 mod 72 即 (5 * d) mod 72 = 1 mod 72，而1除以任何数的余数都为1，可以得到1  mod 72 = 1

设：5 * d / 72 的商为x，得5 * d  = 72x + 1 mod 64

5 * d  = 72x + 1 mod 72

d = (72x + 1)/ 5

当x = 1 时，不能整除

当x = 2 时，能整除，d = 29



**真题**

设在RSA的公钥密码体制中,公钥为(e,n)=(7, 55), 则私钥d= ( )。

A.11	B.15	C.17	D.23



解：已知 n = 55 ，可以推断出φ(n) = (5-1) * (11-1) = 40

根据e * d ≡ 1 mod φ(n) 可得到 7 * d ≡ 1 mod 40

设：7 * d / 40 的商为x，得7 * d  = 40x + 1 mod 40

7 * d  = 40x + 1 mod 40

d = (40x + 1)/7

当x = 1 时，不能整除

当x = 2 时，不能整除

当x = 3 时，不能整除

当x = 4 时，能整除，d = 23



**RSA密码的安全性**

- 因子分解攻击：小合数的因子分解是容易的，然而大合数的因子分解却是十分困难的。要应用 RSA 密码，应当采用足够大的整数 n 。只要合理地选择参数，正确地使用，RSA 就是安全的。
- 为了确保 RSA 密码的安全，必须认真选择 RSA 的密码参数，各个参数选择如下：一般加密密钥和认证密钥选 n 为1024位，而平台根密钥和存储根密钥则选 n 为2048位。p 和 q 要足够大并且 p 和 q 应为强素数。为了使加密速度快，e 的二进制表示中应当含有尽量少的1。为了使解密速度快，希望选用小的d,但是d太小也是不好的。当d小于n的1/4时，己有求出d的攻击方法。不要许多用户共用一个模数n。




## 3.6、国产密码算法
目前，已经公布的国产密码算法主要有`SM1 分组密码算法` 、`SM2 椭圆曲线公钥密码算法`、 `SM3 密码杂凑算法`、 `SM4 分组算法`、 `SM9 标识密码算法`。

-  SM1 算法是一种对称加密算法，分组长度为 128 比特，密钥长度为 128 比特。
-  SM2 算法基于椭圆曲线，应用于公钥密码系统。   SM2 算法可以用千数字签名、密钥交换、公钥加密。
-  SM3 杂凑算法对长度为 (l < 264) 比特的消息 m, 经过填充、迭代压缩，生成杂凑值，杂 凑值输出长度为 256 比特。
-  SM4 密码算法是一个分组算法。该算法的分组长度为 128 比特，密钥长度为 128 比特。加 密算法与密钥扩展算法都采用 32 轮非线性迭代结构。
-  SM9 是标识密码算法。SM9 可支待实现公钥加密密钥交换、数字签名等安全功能




# 4、Hash函数与数字签名

## 4.1、Hash函数
杂凑函数简称 Hash 函数，它能够将任意长度的信息转换成固定长度的哈希值（又称数字摘要或消息摘要），并且任意不同消息或文件所生成的哈希值是不样的。



令 h 表示 Hash 数，则 h 满足下列条件:

1. h 的输入可以是任意长度的消息或文件M
2. h 的输出的长度是固定的
3. 给定 M, 计算 h(M) 是容易的
4. 给定 h 的描述，找两个不同的消息 M1 和M2, 使得 h(M1)=h(M2) 是计算上不可行的




## 4.2、Hash算法
Hash 算法又称为杂凑算法、散列算法、哈希算法或数据摘要算法，其能够将一个任意长比特串映射到一个固定长的比特串。

常见的 Hash 算法有 MD5、SHA、SM3 。



- **MD5算法**：MD5 以 512 位数据块为单位来处理输入，产生 128 位的消息摘要，即 MD5 能产生 128比特长度的哈希值。

- **SHA算法**：SHA-1 与 MD5 的设计原理类似，同样也以 512 位数据块为单位来处理输入，产生 160 的哈希值，具有比 MD5 更强的安全性。

- **SM3国产算法**：SM3 是国家密码管理局于 2010 年公布的商用密码杂凑算法标准。该算法消息分组长度为512 比特，输出杂凑值长度为 256 比特，采用 Merkle-Damgard 结构。




## 4.3、数字签名
数字签名 (Digital Signature) 是指签名者使用私钥对待签名数据的杂凑值做密码运算得到的结果。该结果只能用签名者的公钥进行验证，用千确认待签名数据的完整性、签名者身份的真实性和签名行为的抗抵赖性。



**数字签名至少应满足以下三个条件：** 

1. 非否认。签名者事后不能否认自己的签名。
2. 真实性。接收者能验证签名，而任何其他人都不能伪造签名。
3. 可鉴别性。当双方关于签名的真伪发生争执时，第三方能解决双方之间发生的争执。



一个数字签名方案一般由签名算法和验证算法组成。签名算法密钥是秘密的，只有签名的人掌握；而验证算法则是公开的，以便他人验证。典型的数字签名方案有 RSA 签名制、Rabin 签名体制、 ElGamal 签名体制和 DSS (Data Signature Standard) 标准。



签名与加密很相似，一般是签名者私钥对需签名的数据进行加密，验证方利用签名者的公 钥对签名数据做解密运算。签名与加密的不同之处在于，加密的目的是保护信息不被非授权用户访问，而签名是使消息接收者确信信息的发送者是谁，信息是否被他人篡改。



# 5、密码管理与数字证书

## 5.1、密码管理
密码系统的安全性依赖于密码管理。密码管理主要可以分成三个方面的内容，即密钥管理、 密码管理政策、密码测评。



**密钥管理：**密钥管理主要围绕密钥的生命周期进行，包括密钥生成、密钥存储、密钥分发、密钥使用、 密钥更新、密钥撤销、密钥备份、密钥恢复、密钥销毁、密钥审计。



**密码管理政策**

- 《商用密码管理条例》内容主要有商用密码的科研生产管理、销售管 理、使用管理、安全保密管理。

- 《中华人民共和国密码法》明确规定，密码分为核心密码、普通密码和商用密码，实行分类管理。核心密码、普通密码用于保护国家秘密信息，属于国家秘密，由密码管理部门依法实行严格统一管理，商用密码用于保护不属于国家秘密的信息，公民、法人和其他组织均可依法使用商用密码保护网络与信息安全。



**密码评测**：密码测评是指对相关密码产品及系统进行安全性、合规性评估，以确保相关对象的密码安全有效，保障密码系统的安全运行。目前，国家设立了商用密码检测中心。




## 5.2、数字证书
数字证书 (Dital Certificate) 也称公钥证书，是由证书认证机构 (CA) 签名的包含公开密钥拥有者信息、公开密钥、签发者信息、有效期以及扩展信息的一种数据结构。



**数字证书按类别可分为：**个人证书、机构证书、设备证书。

**按用途可分为：**签名证书、加密证书。



签名证书是用于证明签名公钥的数字证书。

加密证书是用于证明加密公钥的数字证书。



为更好地管理数字证书，一般是基于 PKI 技术建立数字证书认证系统（简称为 CA) CA 提供数字证书的申请、审核、签发、查询、发布以及证书吊销等全生命周期的管理服务。



**数字证书认证系统的构成主要有**：目录服务器、OCSP 服务器、注册服务器、签发服务器

 


# 6、安全协议

##  6.1、Diffie-Hellman 密钥交换协议
Dillie-Hellman 密钥交换协议基于求解离散对数问题的困难性



_C^d = M mod P_



在已知 C 和 P 的前提下，由 d 求 M 很容易，只相当于进行一次指数计算。而再由 M 反过来求 d, 则需要指数级次计算。随着 P 取得足够大，就能实现足够的安全强度。




## 6.2、SSH
SSH是基于公钥的安全应用协议，由 `SSH 输层协议`、 `SSH 用户认证协议`和 `SSH 连接协议`三个子协议组成，各协议分工合作，实现加密、 认证、完整性检查等多种安全服务。

- SSH 传输层协议提供算法协商和密钥交换，并实现服务器的认证，最终形成一个加密的安 全连接，该安全连接提供完整性、保密性和压缩选项服务。
- SSH 用户认证协议则利用传输层的 服务来建立连接，使用传统的口令认证、公钥认证、主机认证等多种机制认证用户。
- SSH 连接 协议在前面两个协议的基础上，利用已建立的认证连接，并将其分解为多种不同的并发逻辑通道，支持注册会话隧道和 TCP 转发 (TCP-forwarding) ，而且能为这些通道提供流控服务以及 通道参数协商机制。



 **SSH 的工作机制共分7个步骤**

1. 客户获取服务器的证书
2. 客户发送SSH连接请求
3. ssh服务器初始化连接请求，发送服务器公钥
4. 客户验证服务器公钥
5. 客户和服务器之间建立DH密钥
6. 服务器认证用户
7. 用户使用SSH Tunnel



用户为了认证服务器的公钥真实性，有三种方法来实现。

1. 用户直接随身携带含有服务器公钥的拷贝，在进行密钥交换协议前，读入客户计算机
2. 从公开信道下载服务器的公钥和它对应的指纹后，先通过电话验证服务器的公钥指纹的真实性，然后用 HASH 软件生成服务器的公钥新指纹，比较下载的指纹和新生成的指纹，若比较结果相同，则表明服务器的公钥是真实的，否则服务器的公钥是虚假的
3. 通过 PKI 技术来验证服务器



SSH 在端口转发技术的基础上，能够支持远程登录 (Telnet)、rsh、rlogin 、文件传输 (scp) 等多种安全服务。

 Linux 系统一般提供 SSH 服务， SSH 的服务进程端口通常为 22  。 虽然 SSH 是一个安全协议，但是也有可能受到中间人攻击和拒绝服务攻击。




# 7、密码学网络安全应用
## 7.1、密码技术常见应用场景类型
**网络用户安全**

1. 基于公钥密码学技术，把用户实体信息与密码数据绑定，形成数字证书，标识网络用户身份，并提供身份鉴别服务
2. 使用加密 技术，保护网络用户的个人敏感信息



**物理和环境安全**

1. 对物理区域访问者的身份进行鉴别，保证来访人员的身份真实性
2. 保护电子门禁系统进出记录的存储完整性和机密性
3. 保证视频监控音像记录的存储完整性和机密性



**网络通信安全**

1. 对通信实体进行双向身份鉴别，保 证通信实体身份的真实性
2. 使用数字签名保证通信过程中数据的完整性
3. 对通信过程 中进出的敏感字段或通信报文进行加密
4. 使用密码安全认证协议对网络设备进行接入认 证，确保接入的设备身份的真实性



**设备和计算安全**

1. 使用密码安全认证协议对登录设备 用户的身份进行鉴别
2. 使用 Hash 函数及密码算法建立可信的计算环境
3. 使用数字签 名验证重要可执行程序来源的真实性
4. 使用加密措施保护设备的重要信息资源，如口令文 件
5. 使用 SSH SSL 等密码技术，建立设备远程管理安全信息传输通道



**应用和数据安全**

1. 使用安全协议及数字证书对登录用 户进行身份鉴别，保证应用系统用户身份的真实性
2. 加密应用系统访问控制信息
3. 应 SSH SSL 等密码技术，传输重要数据，保护重要数据的机密性和完整性
4. 加密存储 重要数据，防止敏感数据泄密
5. 使用 Hash 函数、数字签名等密码技术，保护应用系统的 完整性，防止黑客攻击篡改



**业务应用创新**

1. 利用数字证书和数字签名等密码技 术，构建网络发票
2. 使用 Hash 函数等密码技术，构建区块链
3. 利用密码技术，建立 电子证照




## 7.2、路由器安全应用参考
**路由器口令管理**

为了路由器口令的安全存储，路由器先用 MD5 对管理员口令信息进行 Hash 计算，然后再 保存到路由器配置文件中。



**远程安全访问路由器**

远程访问路由器常用 Telnet, Telnet 容易泄露敏感的口令信息，因此，管理员为增强路 由器的安全管理，使用 SSH 替换 Telnet。



**路由器信息交换认证**

为了防止路由欺诈，路由器之间对路由更新包都进行完整性检查，以保证路由 完整性。目前，路由器常用MD5-HMAC 来实现。如果路由信息在传输过程中被篡改了，接收 路由器通过重新计算收到路由信息的 Hash 值，然后与发送路由器的路由信息的 Hash 值进行比 较，如果两个 Hash 值不相同，则接收路由器拒绝路由更新包。




## 7.3、Web网站安全应用参考
Web 网站是网络应用的重要组成部分。目前，重要信息网站通过数字证书和 SSL 共同保护 Web 服务的安全。利用 SSL 和数字证书，可以防止浏览器和 Web 服务器间的通信信息泄密或被篡改和伪造。




## 7.4、电子邮件安全应用参考
电子邮件是最常见的网络应用，但是普通的电子邮件是明文传递的，电子邮件的保密性难以得到保证，同时电子邮件的完整性也存在安全问题。针对电子邮件的安全问题，人们利用 PGP(Pretty Good Privacy) 来保护电子邮件的安全。 PGP 是一种加密软件，目前最广泛地用千电子邮件安全。 它能够防止非授权者阅读邮件，并能对用户的邮件加上数字签名，从而使收信人可以确信发信人的 身份。 PGP 应用了多种密码技术，其中密钥管理算法选用 RSA、数据加密算法 IDEA、完整性检测和数字签名算法，采用了 MD5 RSA 以及随机数生成器， PGP 将这些密码技术有机集成在一起， 利用对称和非对称加密算法的各自优点，实现了 个比较完善的密码系统。
