<span style='font-size:17px'>

# 1、入侵检测概念

## 1.1、概念
入侵应与受害目标相关联，该受害目标可以是一个大的系统或单个对象。判断与目标相关的操作是否为入侵的依据是：对目标的操作是否超出了目标的安全策略范围。因此，入侵是指违背访问目标的安全策略的行为。入侵检测通过收集操作系统、系统程序、应用程序、网络包等信息，发现系统中违背安全策略或危及系统安全的行为。具有入侵检测功能的系统称为入侵检测系统，简称为 IDS 。




## 1.2、检测模型
最早的入侵检测模型是由 Denning 给出的，该模型主要根据主机系统的审计记录数据，生成有关系统的若干轮廓，并监测轮廓的变化差异，发现系统的入侵行为。

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190830999.png)



随着入侵行为的种类不断增多，许多攻击是经过长时期准备的。面对这种情况，入侵检测系统的不同功能组件之间、不同 IDS 之间共享这类攻击信息是十分重要的。于是，一种通用的入侵检测框架模型被提出，简称为 CIDF 。该模型认为入侵检测系统由事件产生器 (event generators) 、事件分析器 (event analyzers) 、响应单元 (response units) 和事件数据库 (event  databases) 组成

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190832214.png)



CIDF 将入侵检测系统需要分析的数据统称为事件，它可以是网络中的数据包，也可以是从系统日志等其他途径得到的信息。事件产生器从整个计算环境中获得事件，并向系统的其他部分提供事件。事件分析器分析所得到的数据，并产生分析结果。 响应单元对分析结果做出反应，如切断网络连接、改变文件属性、简单报警等应急响应。事件数据库存放各种中间和最终数据，数据存放的形式既可以是复杂的数据库，也可以是简单的文本文件。 CIDF 模型具有很强的扩展性，目前已经得到广泛认同。




## 1.3、入侵检测作用
其作用表现为以下几个方面： 

1. 发现受保护系统中的入侵行为或异常行为；
2. 检验安全保护措施的有效性；
3. 分析受保护系统所面临的威胁；
4. 有利千阻止安全事件扩大，及时报警触发网络安全应急响应；
5. 可以为网络安全策略的制定提供重要指导；
6. 报警信息可用作网络犯罪取证。 

除此之外，入侵检测技术还常用千网络安全态势感知，以获取网络信息系统的安全状况。 




# 2、入侵检测技术
主要包括基于误用的入侵检测技术、基于异常的入侵检测技术和其他技术（包括基于规范的检测方法、基于生物免疫的检测方法、基于攻击诱骗的检测方法、基于入侵报警的关联检测方法、基于沙箱动态分析的检测方法、基于大数据分析的检测方法）




## 2.1、基于误用的入侵检测技术
误用入侵检测通常称为基于特征的入侵检测方法，是指根据已知的入侵模式检测入侵行为。

攻击者常常利用系统和应用软件中的漏洞技术进行攻击，而这些基于漏洞的攻击方法具有某种特征模式。如果入侵者的攻击方法恰好匹配上检测系统中的特征模式，则入侵行为立即被检测到。

 显然，误用入侵检测依赖于攻击模式库。因此，这种采用误用入侵检测技术的 IDS 产品的检测能力就取决于攻击模式库的大小以及攻击方法的覆盖面。如果攻击模式库太小，则 IDS 有效性就大打折扣。而如果攻击模式库过大，则 IDS 的性能会受到影响。

基于上述分析，误用入侵检测的前提条件是，入侵行为能够按某种方式进行特征编码，而入侵检测的过程实际上就是模式匹配的过程。



根据入侵特征描述的方式或构造技术，误用检测方法可以进一步细分为如下几种方法：

- **基于条件概率的误用检测方法**

  基于条件概率的误用检测方法是将入侵方式对应一个事件序列，然后观测事件发生序列， 应用贝叶斯定理进行推理，推测入侵行为。

- **基于状态迁移的误用检测方法**

  基于状态迁移的误用检测方法，利用状态图表示攻击特征，不同状态刻画了系统某一时刻的特征。初始状态对应于入侵开始前的系统状态，危害状态对应于已成功入侵时刻的系统状态。初始状态与危害状态之间的迁移可能有一个或多个中间状态。攻击者的操作将导致状态发生迁移，使系统从初始状态迁移到危害状态。基于状态迁移的误用检测方法通过检查系统的状态变化发现系统中的入侵行为。

- **基于键盘监控的误用检测方法**

  基于键盘监控的误用检测方法，是假设入侵行为对应特定的击键序列模式，然后监测用户的击键模式，并将这一模式与入侵模式匹配，从而发现入侵行为。这种方法的缺点是，在没有操作系统支待的清况下，缺少捕获用户击键的可靠方法。此外，也可能存在多种击键方式表示 同一种攻击。而且，如果没有击键语义分析，用户提供别名（例如 Korn shell) 很容易欺骗这种检测技术。最后，该方法不能够检测恶意程序的自动攻击。

- **基于规则的误用检测方法**

  基于规则的误用检测方法是将攻击行为或入侵模式表示成一种规则，只要符合规则就认定它是一种入侵行为。这种方法的优点是，检测起来比较简单，但是也存在缺点，即检测受到规则库限制，无法发现新的攻击，并且容易受干扰。目前，大部分 IDS 采用的是这种方法。 Snort 是典型的基于规则的误用检测方法的应用实例。




## 2.2、基于异常的入侵检测技术
异常检测方法是指通过计算机或网络资源统计分析，建立系统正常行为的”轨迹“，定义一 组系统正常情况的数值，然后将系统运行时的数值与所定义的”正常“情况相比较，得出是否有被攻击的迹象。

异常检测的前提是异常行为包括入侵行为。理想情况下，异常行为集合等同于入侵行为集合，此时，如果 IDS 能够检测到所有的异常行为，则表明能够检测到所有的入侵行为。 但是在现实中，入侵行为集合通常不等同于异常行为集合。事实上，具体的行为有4种状况： 

1. 行为是入侵行为，但不表现异常。
2. 行为不是入侵行为，却表现异常。
3. 行为既不是入侵行 为，也不表现异常。
4. 行为是入侵行为，且表现异常。

异常检测方法的基本思路是构造异常行为集合，从中发现入侵行为。异常检测依赖于异常模型的建立，不同模型构成不同的检测方法。 



有以下几种常见的异常检测方法：

- **基于统计的异常检测方法**

  基于统计的异常检测方法就是利用数学统计理论技术，通过构建用户或系统正常行为的特征轮廓。典型的系统主体特征有：系统的登录与注销时间， 资源被占用的时间以及处理机、内存和外设的使用情况等。对收集到的数据进行统计处理，并与描述主体正常行为的统计性特征轮廓进行比较，然后根据二者的偏差是否超过指定的门限来进一步判断、处理。

- **基于模式预测的异常检测方法**

  基于模式预测的异常检测方法的前提条件是：时间序列不是随机发生的而是服从某种可辨别的模式，其特点是考虑了事件序列之间的相互联系。安全专家 Teng 和 Chen 给出了一种基于时间的推理方法，利用时间规则识别用户正常行为模式的特征。通过归纳学习产生这些规则集， 并能动态地修改系统中的这些规则，使之具有较高的预测性、准确性和可信度。如果规则大部分时间是正确的，并能够成功地用于预测所观察到的数据，那么规则就具有较高的可信度。这种方法的主要优点有：

  1. 能较好地处理变化多样的用户行为，并具有很强的时序模式。
  2. 能够集中考察少数几个相关的安全事件，而不是关注可疑的整个登录会话过程。
  3. 容易发现针对检测系统的攻击。

- **基于文本分类的异常检测方法**

  基于文本分类的异常检测方法的基本原理是将程序的系统调用视为某个文档中的”字“,而进程运行所产生的系统调用集合就产生一个“文档”。对于每个进程所产生的“文档”，利用K -最近邻聚类文本分类算法，分析文档的相似性，发现异常的系统调用，从而检测入侵为。

- **基于贝叶斯推理的异常检测方法**

  基于贝叶斯推理的异常检测方法，是指在任意给定的时刻，测量 A1, A2,... An变量值， 推理判断系统是否发生入侵行为。其中，每个变量 Ai 表示系统某一方面的特征。




## 2.3、其它入侵检测技术
- **基于规范的检测方法**

  基于规范的入侵检测方法介于异常检测和误用检测之间，其基本原理是，用一种策略描述语言 PE-grammars 事先定义系统特权程序有关安全的操作执行序列，每个特权程序都有一组安全操作序列，这些操作序列构成特权程序的安全跟踪策略 (trace policy) 。若特权程序的操作序列不符合已定义的操作序列就进行入侵报警。这种方法的优点是，不仅能够发现已知的攻击，而且也能发现未知的攻击。

- **基于生物免疫的检测方法**

  基于生物免疫的检测方法，是指模仿生物有机体的免疫系统工作机制，使受保护的系统能够将“非自我"的攻击行为与“自我"的合法行为区分开来。该方法综合了异常检测和误用检测两种方法，其关键技术在于构造系统”自我“标志以及标志演变方法。

- **基于攻击诱骗的检测方法**

  基于攻击诱骗的检测方法，是指将一些虚假的系统或漏洞信息提供给入侵者，如果入侵者应用这些信息攻击系统，就可以推断系统正在遭受入侵，并且安全管理员还可以诱惑入侵者，进一步跟踪攻击来源

- **基于入侵报警的关联检测方法**

  基于入侵报警的关联检测方法是通过对原始的 IDS 报警事件的分类及相关性分析来发现复杂攻击行为。其方法可以分为三类：

  1. 第一类基于报警数据的相似性进行报警关联分析；

  2. 第二类通过人为设置参数或通过机器学习的方法进行报警关联分析；

  3. 第三类根据某种攻击的前提条件与结果进行报警关联分析。

  基于入侵报警的关联检测方法，有助于在大量报警数据中挖掘出潜在的关联安全事件，消除冗余安全事件，找出报警事件的相关度及关联关系，从而提高入侵判定的准确性。

- **基于沙箱动态分析的检测方法**

  基于沙箱动态分析的检测方法是指通过构建程序运行的受控安全环境，形成程序运行安全沙箱，然后监测可疑恶意文件或程序在安全沙箱的运行状况，获取可疑恶意文件或可疑程序的动态信息，最后检测相关信息是否异常，从而发现入侵行为。

- **基于大数据分析的检测方法**

  基于大数据分析的检测方法是指通过汇聚系统日志、 IDS 报警日志、防火墙日志、 DNS日志、网络威胁情报、全网流量等多种数据资源，形成网络安全大数据资源池，然后利用人工智能技术，基于网络安全大数据进行机器学习，以发现入侵行为。常见的大数据分析检查技术有数据挖掘、深度学习、数据关联、数据可视化分析等。




# 3、入侵检测系统组成与分类

## 3.1、入侵检测系统的组成
 一个入侵检测系统主要由以下功能模块组成：数据采集模块、入侵分析引擎模块、应急处理模块、管理配置模块和相关的辅助模块。

1. 数据采集模块的功能是为入侵分析引擎模块提供分析用的数据，包括操作系统的审计日志、应用程序的运行日志和网络数据包等。
2. 入侵分析引擎模块的功能是依据辅助模块提供的信息（如攻击模式），根据一定的算法对收集到的数据进行分析，从中判断是否有入侵行为出现，并产生入侵报警。该模块是入侵检测系统的核心模块。 
3. 管理配置模块的功能是为其他模块提供配置服务，是 IDS 系统中的模块与用户的接口。
4. 应急处理模块的功能是发生入侵后，提供紧急响应服务，例如关闭网络服务、中断网络连接、启动备份系统等。
5. 辅助模块的功能是协助入侵分析引擎模块工作，为它提供相应的信息，例如攻击特征库、漏洞信息等。

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190904955.png)




## 3.2、入侵检测系统的分类
根据 IDS 的检测数据来源和它的安全作用范围， 可将 IDS 分为三大类：

1. 基于主机的入侵检测系统（简称 HIDS) ，即通过分析主机的信息来检测入侵行为；
2. 基于网络的入侵检测系统（简称 NIDS) ，即通过获取网络通信中的数据包，对这些数据包进行攻击特征扫描或异常建模来发现入侵行为；
3. 分布式入侵检测系统（简称 DIDS) ，从多台主机、多个网段采集检测数据，或者收集单个 IDS 的报警信息，根据收集到的信息进行综合分析，以发现入侵行为。



**基于主机的入侵检测系统**

基于主机的入侵检测系统，简称为 HIDS。HIDS 通过收集主机系统的日志文件、系统调用以及应用程序的使用、系统资源、网络通信和用户使用等信息，分析这些信息是否包含攻击特征或异常情况，并依此来判断该主机是否受到入侵。由于入侵行为会引起主机系统的变化，因此在实际的 HIDS 产品中， CPU 利用率、内存利用率、磁盘空间大小、网络端口使用情况、注册表、文件的完整性、进程信息、系统调用等常作为识别入侵事件的依据。

 HIDS 一般适合检测以下入侵行为：

- 针对主机的端口或漏洞扫描；
- 重复失败的登入尝试；
- 远程口令破解；
- 主机系统的用户账号添加；
- 服务启动或停止；
- 系统重启动；
- 文件的完整性或许可权变化；
- 注册表修改；
- 重要系统启动文件变更；
- 程序的异常调用；
- 拒绝服务攻击。



HIDS 中的软件：

1. SWATCH(The Simple WATCHer and filer)，Todd Atkins 开发的用于实时监视日志的 PERL 程序。
2. Tripwire，一个文件和目录完整性检测工具软件包，用于协助管理员和用户监测特定文件的变化。
3. 网页防篡改系统，基本作用是防止网页文件被入侵者非法修改，即在页面文件被篡改后，能够及时发现、产生报警、通知管理员、自动恢复。其工作原理是将所要监测的网页文件生成完整性标记， 旦发现网页文件的完整性受到破坏，则启动网页备份系统，恢复正常的网页。



基于主机的入侵检测系统优点：

- 可以检测基于网络的入侵检测系统不能检测的攻击。
- 可以运行在应用加密系统的网络上，只要加密信息在到达被监控的主机时或到达前解密。
- 可以运行在交换网络中。



基于主机的入侵检测系统的缺点：

- 必须在每个被监控的主机上都安装和维护信息收集模块。
- 由于 HIDS 的一部分安装在被攻击的主机上， HIDS 可能受到攻击并被攻击者破坏。
- HIDS 占用受保护的主机系统的系统资源，降低了主机系统的性能。
- 不能有效地检测针对网络中所有主机的网络扫描。
- 不能有效地检测和处理拒绝服务攻击。
- 只能使用它所监控的主机的计算资源。



**基于网络的入侵检测系统**

基于网络的入侵检测系统，简称为 NIDS。NIDS 通过侦听网络系统，捕获网络数据包，并依据网络包是否包含攻击特征，或者网络通信流是否异常来识别入侵行为。 NIDS 通常由一组用途单一的计算机组成，其构成多分为两部分：探测器和管理控制器。

- 探测器分布在网络中的不同区域，通过侦听（嗅探）方式获取网络包，探测器将检测到攻击行为形成报警事件，向管理控制器发送报警信息，报告发生入侵行为。
- 管理控制器可监控不同网络区域的探测器，接收来自探测器的报警信息。



NIDS 能够检测到以下入侵行为：

- 同步风暴 (SYN Flood) 。
- 分布式拒绝服务攻击 (DDoS) 。
- 网络扫描。
- 缓冲区溢出。
- 协议攻击。
- 流最异常。
- 非法网络访问。 



当前， NIDS 的软件产品有许多，国外产品有 Session Wall、ISS RealSecure、Cisco Secure IDS 等，国内的 IDS 产品公司有东软集团、北京天融信网络安全技术有限公司、绿盟科技集团股份有限公司、华为技术有限公司等。此外，因特网上有公开源代码的网络入侵检测系统 Snort。

Snort 是轻量型的 NIDS, 它首先通过 libpcap 软件包监听 (sniffer/logger) 获得网络数据包，然后进行入侵检测分析。其主要方法是基于规则的审计分析，进行包的数据内容搜索/匹配。目前， Snort 能检测缓冲区溢出、端口扫描、 CGI 攻击、 SMB 探测等多种攻击，还具有实时报警功能。 



基于网络的入侵检测系统的优点：

- 适当的配置可以监控一个大型网络的安全状况。
- 系统的安装对已有网络影响很小，通常属于被动型的设备，它们只监听网络而不干扰网络的正常运作。
- 可以很好地避免攻击，对于攻击者甚至是不可见的。



基于网络的入侵检测系统的缺点：

- 在高速网络中， NIDS 很难处理所有的网络包，因此有可能出现漏检现象。
- 交换机可以将网络分为许多小单元 VLAN, 而多数交换机不提供统一的监测端口，这就减少了基于网络的入侵检测系统的监测范围。
- 如果网络流量被加密， NIDS 中的探测器无法对数据包中的协议进行有效的分析。
- NIDS 仅依靠网络流量无法推知命令的执行结果，从而无法判断攻击是否成功。



**分布式入侵检测系统**

网络系统结构的复杂化和大型化，带来许多新的入侵检测问题。

1. 系统的漏洞分散在网络中的各个主机上，这些弱点有可能被攻击者一起用来攻击网络， 仅依靠基于主机或网络的 IDS 不会发现入侵行为。
2. 入侵行为不再是单一的行为，而是相互协作的入侵行为。
3. 入侵检测所依靠的数据来源分散化，收集原始的检测数据变得困难。如交换型网络使监听网络数据包受到限制。
4. 网络传输速度加快，网络的流量增大，集中处理原始数据的方式往往造成检测瓶颈， 从而导致漏检。 

面对这些新的入侵检测问题，分布式入侵检测系统应运而生，它可以跨越多个子网检测攻击行为，特别是大型网络。分布式入侵检测系统可以分成两种类型，即基于主机检测的分布式 入侵检测系统和基于网络的分布式入侵检测系统。



**1、基于主机检测的分布式入侵检测系统**

基于主机检测的分布式入侵检测系统，简称为 HDIDS, 其结构分为两个部分：主机探测器 和入侵管理控制器。 HDIDS 将主机探测器按层次、分区域地配置、管理，把它们集成为一个可用于监控、保护分布在网络区域中的主机系统。

HDIDS 用于保护网络的关键服务器或其他具有敏感信息的系统，利用主机的系统资源、系统调用、审计日志等信息，判断主机系统的运行是否遵循安全规则。在实际工作过程中，主机探测器多以安全代理 (Agent) 的形式直接安装在 每个被保护的主机系统上，并通过网络中的系统管理控制台进行远程控制。这种集中式的控制方式，便于对系统进行状态监控、管理以及对检测模块的软件进行更新。

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190920006.png)



**2、基于网络的分布式入侵检测系统** 

基于网络的分布式入侵检测系统，简称为 NDIDS。NDIDS 的结构分为两部分：网络探测器和管理控制器。网络探测器部署在重要的网络区域，如服务器所在的网段，用于收集网络通信数据和业务数据流，通过采用异常和误用两种方法对收集到的信息进行分析，若出现攻击或异常网络行为，就向管理控制器发送报警信息。

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190920108.png)

NDIDS 一般适用于大规模网络或者是地理区域分散的网络，采用这种结构有利于实现网络的分布式安全管理。现在市场上的网络入侵系统一般支持分布式结构。



综上所述，分布式 IDS 的系统结构能够将基于主机和网络的系统结构结合起来，检测所用到的数据源丰富，可以克服前两者的弱点。但是，由于是分布式的结构，所以也带来了新的弱点。例如，传输安全事件过程中增加了通信的安全问题处理，安全管理配置复杂度增加等。




#   4、入侵检测系统主要产品于技术指标

## 4.1、入侵检测相关产品

**1、主机入侵检测系统**

产品技术原理是根据主机活动信息及重要文件，采用特征匹配、系统文件监测、安全规则 符合检查、文件数字指纹、大数据分析等综合技术方法发现入侵行为。典型产品形态有终端安全产品，如北信源主机监控审计系统、 360 安全卫士、 McAfee MVISION Endpoint Detection and Response (EDR) 等。



**2、网络入侵检测系统**

产品技术原理是根据网络流量数据进行分析，利用特征检测、协议异常检测等技术方法发 现入侵行为。



**3、统一威胁管理**

统一威胁管理（简称为 UTM) 通常会集成入侵检测系统相关的功能模块，是入侵检测技 术产品的表现形态之一。统一威胁管理是由硬件、软件和网络技术组成的具有专门用途的设备， 该设备主要提供一项或多项安全功能，同时将多种安全特性集成于一个硬件设备里，形成标准的统一威胁管理平台。其通过统一部署的安全策略，融合多种安全功能，是针对网络及应用系统的安全威胁进行综合防御的网关型设备或系统。 UTM 通常部署在内部网络与外部网络的边界，对流出和进入内部网络的数据进行保护和控制。 UTM 在实际网络中的部署方式通常包括透明网桥、路由转发和 NAT 网关。



**4、高级持续威胁检测**

高级持续威胁（简称为 APT) 是复杂性攻击技术，通常将恶意代码嵌入 Word 文档、 Excel 文档、 PPT 文档、 PDF 文档或电子邮件中，以实现更隐蔽的网络攻击，以逃避普通的网络安全检查。例如，肚脑虫 (Donot) 组织以“克什米尔问题”命名的诱饵漏洞文档，该文档利用了 CVE-2017-8570 漏洞，其主要的攻击流程如图

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190922427.png)

高级待续威胁检测系统是入侵检测技术产品的特殊形态，其产品技术原理基于静态／动态分析检测可疑恶意电子文件及关联分析网络安全大数据以发现高级持续威胁活动。目前，国内的 APT 产品有安天追影威胁分析系统、 360 天眼新一代威胁感知系统、华为FireHunter6000系列沙箱及 CIS 网络安全智能系统。



**5、其它产品**

根据入侵检测应用对象，常见的产品类型有 Web IDS 、数据库 IDS 、工控 IDS 等。

1. Web IDS 利用 Web 网络通信流量或 Web 访问日志等信息，检测常见的 Web 攻击，如 Webshell SQL 注入、远程文件包含 (RFI) 、跨站点脚本 (XSS) 等攻击行为；
2. 数据库 IDS 利用数据库网络通信流量或数据库访问日志等信息，对常见的数据库攻击行为进行检测，如数据库系统口 令攻击、 SQL 注入攻击、数据库漏洞利用攻击等；
3. 工控 IDS 通过获取工控设备、工控协议相关信息，根据工控漏洞攻击检测规则、异常报文特征和工控协议安全策略，检测工控系统的攻击行为。




## 4.2、入侵检测相关指标

1. **可靠性**

   由于入侵检测系统需要不间断地监测受保护系统，因此，要求入侵检测系统具有容错能力，可以连续运行。

2. **可用性**

   入侵检测系统运行开销要尽呈小，特别是基于主机的入侵检测系统，入侵检测系统不能影响到主机和网络系统的性能。

3. **可扩展性**

   该指标主要评价入侵检测系统是否易千配置修改和安装部署的能力，以适应新的攻击技术方法不断出现和系统环境的变迁需求。

4. **时效性**

   时效性要求入侵检测系统必须尽快地分析报警数据，并将分析结果传送到报警控制台，以使系统安全管理者能够在入侵攻击尚未造成更大危害以前做出反应，阻止攻击者破坏审计系统甚至入侵检测系统的企图。

5. **准确性**

   准确性是指入侵检测系统能正确地检测出系统入侵活动的能力。当一个入侵检测系统的检测不准确时，它就可能把系统中的合法活动当作入侵行为，或者把入侵行为作为正常行为，这时就出现误报警和漏报警现象，实用的入侵检测系统应具有低的误警率和漏警率。

6. **安全性**

   入侵检测系统本身也往往存在安全漏洞。若对入侵检测系统攻击成功， 则直接导致报警失灵，使攻击者的攻击行为无法被记录。因此，入侵检测系统的安全性要求具有保护自身的安全功能，能够抗攻击干扰。




# 5、入侵检测系统应用

## 5.1、入侵检测应用场景类型

1. **上网保护**

   通过采集域名请求数据及网络威胁情报，利用入侵检测系统检测不良网址， 保护上网计算机安全，防止互联网黑客直接攻击内部网络，切断不良信息访问。

2. **网站入侵检测与保护**

   通过入侵检测技术对 Web 服务器的所有请求或 Web 访问日志进行检测，发现网站安全威胁。

3. **网络攻击阻断**

   在受保护的区域边界处部署入侵检测系统，对受保护设备的网络通信进行安全检测，阻断具有攻击特征的操作，防止攻击行为。

4. **主机／终端恶意代码检测**

   在主机／终端设备上安装入侵检测系统或功能模块，检测主机服务器、终端设备的攻击行为，防止主机或终端设备受到侵害。

5. **网络安全监测预警与应急处置**

   利用检测系统监测网络信息系统中的异常行为，及时发现入侵事件，追踪恶意攻击源，防止网络安全事件影响扩大。

6. **网络安全等级保护**

   入侵检测技术是实现网络安全等级保护相关要求的重要支撑，详细情况可参看国家标准《信息安全技术 网络安全等级保护基本要求 (GB/T 22239 2019) 》。目前，入侵检测技术常用于网络安全等级保护对象中，如在关键网络节点处监视网络攻击行为；检测虚拟机与宿主机、虚拟机与虚拟机之间的异常流量；检测针对无线接入设备的网络扫描、 DDoS 攻击、密钥破解、中间人攻击和欺骗攻击。




## 5.2、入侵检测系统部署方法
IDS 部署是指将 IDS 安装在网络系统区域中，使之能够检测到网络中的攻击行为。

IDS 部署的基本过程包含以下几个步骤：

1. 根据组织或公司的安全策略要求，确定 IDS 要监测的对象或保护网段。
2. 在监测对象或保护网段，安装 IDS 探测器，采集网络入侵检测所需要的信息。
3. 针对监测对象或保护网段的安全需求，制定相应的检测策略。
4. 依据检测策略，选用合适的 IDS 结构类型。
5. 在 IDS 上，配置入侵检测规则。
6. 测试验证 IDS 的安全策略是否正常执行。
7. 运行和维护 IDS 。




## 5.3、基于 HIDS 的主机威胁检测
HIDS 般用于检测针对单台主机的入侵行为，其主要应用方式如下：

1. 单机应用在 这种应用方式下，把 HIDS 系统直接安装在受监测的主机上即可。
2. 分布式应用 这种应用方式需要安装管理器和多个主机探测器 (Sensor) 。管理器控制多个主机探测器 (Sensor) ，从而可以远程监控多台主机的安全状况。

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190926766.png)




## 5.3、基于 NIDS 的内网威胁检测
将网络 IDS 的探测器接在内部网的广播式 Hub 或交换机的 Probe 端口。 探测器通过采集内部网络流量数据，然后基于网络流量分析监测内部网的网络活动，从而可以发现内部网络的入侵行为。

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190828948.png)




## 5.4、基于 NIDS 的网络边界威胁检测
NIDS 的探测器接在网络边界处，采集与内部网进行通信的数据包，然后分析来自外部 的入侵行为。

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190927733.png)




## 5.5、网络安全态势感知应用参考
网络安全态势感知通过汇聚 IDS 报警信息、系统日志，然后利用大数据分析技术对网络系统的安全状况进行分析，监测网络安全态势。

下面以安全洋葱 (Security Onion) 为例进行说明。安全洋葱通过集成 Elasticsearch、Logstash、Kibana、Snort、Suricata、Bro、Sguil、Squert、CyberChef、NetworkMiner 等相关技术，提供入侵检测、企业安全监测和日志管理等安全服务。其中， Snort、Suricata、Bro、OSSEC 为入侵检测系统。

 ![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190929749.png)




## 5.6、开源网络入侵检测系统
常见的开源网络入侵检测系统有 Snort、Suricata、Bro Zeek、OpenDLP、Sagan 等。本 文以 Snort 为例，给出开源 IDS 应用作为参考。

Snort 是应用较为普遍的网络入侵检测系统，其基本技术原理是通过获取网络数据包，然 后基于安全规则进行入侵检测，最后形成报警信息。 Snort 规则由两部分组成，即规则头和规则选项。规则头包含规则操作 (action) 、协议 (protocol) 、源地址和目的 IP 地址及网络掩码、源地址和目的端口号信息。规则选项包含报警消息、被检查网络包的部分信息及规则应采取的动作。

```
aler tcp any any-> 192.168.1.0/24 111 (conent:"|00 01 86 a5 |"; msg:"mountd access";) 
```
其中，规则头和规则选项通过`()`来区分，规则选项内容用括号括起来。规则头常见的动作有 alert、log、pass、activate、dynamic，规则选项是 Snort 入侵检测的引擎核心，所有 Snort 规则选项都用`;`隔开， 规则选项关键词使用`:`和对应的参数区分， Snort 提供十五个规则选项关键词。规则选项关键词常用的是 msg 和 content。msg 用于显示报警信息，content 用于指定匹配网络数据包的内容。




## 5.7、华为 CIS 网络安全智能系统应用
华为 CIS (Cybersecurity Intelligence System, 网络安全智能系统）采用最新的大数据分析和机器学习技术，用于抵御 APT 攻击。其产品技术原理是从海量数据中提取关键信息，通过多维度风险评估，采用大数据分析方法关联单点异常行为，从而还原出 APT 攻击链，准确识别和防御 APT 攻击，避免核心信息资产损失。

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190930044.png)



CIS 基于大数据平台，采用机器学习模式，针对 APT 攻击过程进行检测。 CIS 提供文件异常检测、Mail 异常检测、C&C 检测、流最基线异常检测、隐蔽通道检测、攻击链关联等安全功能。 

![image.png](https://cdn.jsdelivr.net/gh/xmtxsec/picture/imgl/202404190930811.png)

![image.png](..\..\_img\assets/1658306994623-d12066d5-47ac-4296-8c4a-b6600a1fe538.png)

</span>